<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Phoenix</title>
    <!-- Load Tailwind CSS for a modern, responsive main page look -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Space Mono font for the classic terminal look -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Enable smooth scrolling for anchor links */
        html {
            scroll-behavior: smooth;
        }

        /* Configure Tailwind to use the Space Mono font when available */
        :root {
            --font-mono: 'Space Mono', monospace;
            --main-color: #ffb861; /* Amber/Orange Default */
            --info-color: #f7a049;
            --success-color: #00ff41;
            --error-color: #ff6347;
            --prompt-color: #93d6e5;
        }

        /* Custom CSS for the Terminal Interface (Hacker Aesthetic) */
        .terminal-theme {
            background-color: #0d0101; /* Very dark red/black background */
            color: var(--main-color);
            font-family: var(--font-mono);
            /* CRT Glow Effect */
            text-shadow: 0 0 7px rgba(255, 184, 97, 0.7); /* Soft amber glow */
            /* Scanline Effect */
            background-image: linear-gradient(
                rgba(0, 0, 0, 0.2) 2px,
                transparent 2px
            );
            background-size: 100% 4px; /* Creates subtle horizontal lines */
        }

        .terminal-container {
            width: 95%;
            max-width: 1024px;
            height: 95vh;
            max-height: 800px;
            border: 2px solid var(--main-color);
            box-shadow: 0 0 15px var(--main-color);
        }

        .terminal-header {
            background-color: rgba(255, 184, 97, 0.1);
            color: var(--main-color);
            border-bottom: 2px solid var(--main-color);
            display: flex; /* Ensure header content is flexible */
            justify-content: space-between;
        }

        .terminal-output, .terminal-input {
            overflow-y: auto;
            word-wrap: break-word;
            padding: 0.5rem 1rem;
        }

        .terminal-input-line {
            display: flex;
            align-items: flex-start;
            flex-wrap: nowrap;
            padding: 0.25rem 0;
        }

        .prompt-char {
            color: var(--prompt-color);
            flex-shrink: 0;
            padding-right: 0.5rem;
        }

        /* Styling for different message types */
        .info-message { color: var(--info-color); }
        .success-message { color: var(--success-color); }
        .error-message { color: var(--error-color); }
        .typing-effect::after {
            content: '_';
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        /* Sidebar Styling */
        .settings-sidebar {
            background-color: #1a0808; /* Darker, themed background */
            color: var(--main-color);
            border-left: 2px solid var(--main-color);
        }

        .color-option {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 9999px; /* circle */
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }
        .color-option:hover {
            transform: scale(1.1);
            border-color: #ffffff;
        }
        .color-option.selected {
            border-color: var(--prompt-color);
            box-shadow: 0 0 5px var(--prompt-color);
        }
        
        /* Utility class to display truncated user ID on hover (No longer used, but kept for potential future use) */
        .user-id-display:hover .full-user-id {
            display: block;
        }
        .full-user-id {
            display: none;
            position: absolute;
            bottom: 100%; /* Position above the element */
            left: 50%;
            transform: translateX(-50%);
            background-color: #202020;
            color: var(--main-color);
            padding: 0.5rem;
            border-radius: 0.25rem;
            z-index: 1000;
            white-space: nowrap;
        }

        /* Navigation Links Styling */
        .nav-link {
            color: var(--main-color);
            text-shadow: 0 0 5px rgba(255, 184, 97, 0.5);
            transition: color 0.3s, text-shadow 0.3s;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-weight: 700;
        }
        .nav-link:hover {
            color: var(--prompt-color);
            text-shadow: 0 0 10px var(--prompt-color);
            background-color: rgba(255, 184, 97, 0.1);
        }
    </style>
</head>

<!-- APPLYING AMBER THEME TO THE MAIN BODY -->
<body class="bg-[#0d0101] text-[#ffb861] min-h-screen flex flex-col items-center p-4 font-mono">
    
    <!-- Top Navigation Bar (Updated to span both corners) -->
    <header class="fixed top-0 left-0 right-0 p-4 z-40 flex justify-between items-center">
        <!-- Left Section: Portfolio Button -->
        <div>
            <a href="https://portfolio.silhouetto.win" class="nav-link uppercase text-sm font-bold">
                // PORTFOLIO
            </a>
        </div>
        <!-- Right Section: Nav Links -->
        <nav class="space-x-4 text-sm font-bold">
            <a href="#about" class="nav-link">ABOUT</a>
            <a href="#services" class="nav-link">SERVICES</a>
            <a href="#contact" class="nav-link">CONTACT</a>
        </nav>
    </header>

    <!-- Main Landing Page Content -->
    <div id="landing-page" class="text-center pt-24 pb-12 w-full flex flex-col items-center justify-center min-h-[50vh]">
        <!-- Text updated to PROJECT PHOENIX -->
        <h1 class="text-5xl md:text-7xl font-bold mb-8 drop-shadow-[0_0_15px_rgba(255,184,97,0.7)] tracking-wider">
            PROJECT PHOENIX
        </h1>
        <p class="mb-10 text-xl text-gray-400">
            Access Authorized. Initialization Protocol Engaged.
        </p>
        
        <button id="launch-btn" 
                class="bg-[#ffb861] text-black font-bold py-3 px-8 rounded-lg uppercase 
                       shadow-[0_0_10px_#ffb861] hover:bg-[#ff8c4a] transition duration-300 transform hover:scale-105">
            LAUNCH TERMINAL
        </button>
    </div>

    <!-- Additional Content Sections -->
    <main class="w-full">
        <!-- ABOUT SECTION -->
        <section id="about" class="py-20 md:py-32 w-full max-w-4xl px-4 mx-auto terminal-theme border-t-2 border-dashed border-[var(--info-color)]">
            <h2 class="text-4xl font-bold mb-6 text-[var(--prompt-color)]">// SECTION: ABOUT ME</h2>
            <div class="text-lg space-y-4">
                <p>My journey into programming started when I was about seven or eight, and I haven't stopped since. I just love learning new things, especially anything technical. I'm currently focused on freelance programming in the Roblox ecosystem, but my ultimate goal is to switch over to larger, real-world programming projects.</p>
        
                <p>I am most proficient in **Python**, which is my primary language, but my toolkit is broad. I'm skilled in **C#**, **Java**, **Roblox Scripting**, and **n8n** automation, plus I have professional experience with Unity game development. I am also familiar with **C++** and **HTML/CSS**.</p>
        
                <p>I thrive on autonomy. I'm a fast, self-directed learner, and I believe my best work comes from taking complete ownership of a project. I prefer to defy authority and hate being told what to do, which means I will always deliver results without needing constant oversight or micro-management.</p>
        
                <p class="text-[var(--success-color)]">// PRIMARY_LANGUAGE: PYTHON</p>
            </div>
        </section>

        <!-- SERVICES SECTION -->
        <section id="endorsements" class="py-20 md:py-32 w-full max-w-4xl px-4 mx-auto terminal-theme bg-black/10 border-t-2 border-dashed border-[var(--info-color)]">
            <h2 class="text-4xl font-bold mb-6 text-[var(--prompt-color)]">// ENDORSEMENT_LOGS</h2>
            <div class="text-lg space-y-6">
        
                <blockquote class="border-l-4 border-[var(--success-color)] pl-4 italic text-slate-300">
                    <p>"The Python automation script was flawless. Delivered ahead of schedule and solved a complicated data problem without any hand-holding. True autonomy."</p>
                    <footer class="mt-2 text-sm text-[var(--success-color)]">— **A. Mendez**, *Data Solutions Group*</footer>
                </blockquote>

                <blockquote class="border-l-4 border-[var(--info-color)] pl-4 italic text-slate-300">
                    <p>"We tasked him with a C# utility build, and he provided the solution quickly, showing deep expertise. His fast-learning ability is a major asset."</p>
                    <footer class="mt-2 text-sm text-[var(--info-color)]">— **K. Patel**, *Indie Game Studio Lead*</footer>
                </blockquote>

                <blockquote class="border-l-4 border-[var(--prompt-color)] pl-4 italic text-slate-300">
                    <p>"The Roblox economy systems were complex, but he delivered stable, optimized code that scaled perfectly. Professional and highly independent."</p>
                    <footer class="mt-2 text-sm text-[var(--prompt-color)]">— **R. Chen**, *Roblox Project Owner*</footer>
                </blockquote>
        
                <blockquote class="border-l-4 border-[var(--main-color)] pl-4 italic text-slate-300">
                    <p>"Provided excellent technical documentation and debugging support on a legacy Java project. Highly recommend for independent problem-solving."</p>
                    <footer class="mt-2 text-sm text-[var(--main-color)]">— **J. Sadowski**, *Tech Consultant*</footer>
                </blockquote>
        
            </div>
        </section>

        <!-- CONTACT SECTION -->
        <section id="contact" class="py-20 md:py-32 w-full max-w-4xl px-4 mx-auto terminal-theme border-t-2 border-dashed border-[var(--info-color)]">
            <h2 class="text-4xl font-bold mb-6 text-[var(--prompt-color)]">// ACCESS_POINT</h2>
            <div class="text-lg space-y-4">
        
                <p>I am available for new freelance programming commissions. Please use the preferred communication channels below to submit a project inquiry or to discuss a collaboration.</p>
        
                <ul class="list-none space-y-3 font-mono">
                    <li class="flex items-start">
                        <span class="text-[var(--success-color)] mr-3">> EMAIL:</span>
                        <a href="mailto:silhouetto@n8nstuff.work" class="text-white underline hover:text-[var(--success-color)] break-all">silhouetto@n8nstuff.work</a>
                    </li>
            
                    <li class="flex items-start">
                        <span class="text-[var(--info-color)] mr-3">> DISCORD:</span>
                        <span class="text-white break-all">@obsoletechrisbob</span>
                        <span class="text-sm text-gray-500 ml-2">(Preferred Method)</span>
                    </li>
            
                    <li class="flex items-start">
                        <span class="text-[var(--error-color)] mr-3">> PHONE:</span>
                        <span class="text-white break-all">314-760-4762</span>
                    </li>
                </ul>
        
                <p class="mt-8 pt-4 border-t border-dashed border-[var(--info-color)]">I look forward to discussing your project and demonstrating the value of autonomous development.</p>
        
            </div>
        </section>
    </main>

    <!-- Floating Ticket Button (Hackery Look) -->
    <button id="ask-float-btn" 
            class="fixed bottom-6 right-6 p-4 rounded-full bg-[#333] text-gray-200 shadow-[0_0_15px_#93d6e5]
                   hover:bg-[#20b2aa] transition duration-300 z-50">
        <!-- Re-purposed SVG icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zm-1 9a1 1 0 112 0v2a1 1 0 11-2 0v-2zm1-5a1 1 0 011 1v2a1 1 0 11-2 0V7a1 1 0 011-1z" />
        </svg>
    </button>
    
    <!-- Ticket Modal (Hidden by Default) -->
    <div id="ask-modal-wrapper" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[100]">
        <div class="bg-[#0d0101] p-6 rounded-xl shadow-[0_0_20px_#ffb861] w-11/12 md:w-1/2 lg:w-1/3 border-2 border-[#ffb861]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-[#93d6e5]">// TICKET_SUBMISSION_PROTOCOL</h3>
                <button id="ask-modal-close" class="text-[#ff6347] hover:text-white">&times;</button>
            </div>

            <!-- NEW: Email Input Field -->
            <input type="email" id="ask-modal-email" 
                   class="w-full p-3 mb-3 bg-black text-[#93d6e5] border border-[#ffb861] rounded-md focus:outline-none focus:ring-1 focus:ring-[#93d6e5]" 
                   placeholder="Response Email Address (required)" required>

            <textarea id="ask-modal-input" class="w-full h-24 p-3 bg-black text-[#00ff41] border border-[#ffb861] rounded-md focus:outline-none focus:ring-1 focus:ring-[#93d6e5]" placeholder="Enter your support or operational ticket details..."></textarea>
            <p id="modal-response" class="mt-4 text-sm text-[#ffb861] min-h-[20px] whitespace-pre-wrap"></p>
            <button id="ask-modal-submit" class="mt-4 w-full bg-[#ffb861] text-black font-bold py-2 rounded-md hover:bg-[#ff8c4a] transition">
                SUBMIT TICKET
            </button>
            <div id="modal-loading-indicator" class="mt-4 hidden text-center text-[#93d6e5]">
                // TRANSMITTING TICKET... <span class="typing-effect"></span>
            </div>
        </div>
    </div>


    <!-- Terminal Overlay (Hidden by Default) -->
    <div id="terminal-wrapper" 
         class="fixed inset-0 hidden flex-col items-center justify-center p-4 z-50 terminal-theme">
        
        <div id="terminal-container" class="terminal-container flex flex-col shadow-2xl">
            
            <!-- Terminal Header/Menu Bar -->
            <div class="terminal-header p-2 text-sm">
                <!-- Left Section: Status (Removed User/System Status) -->
                <div class="flex space-x-4 items-center">
                    <span class="font-bold">
                        // PROJECT_PHOENIX_TERMINAL
                    </span>
                </div>
                <!-- Right Section: Control Buttons -->
                <div class="flex space-space-x-2">
                    <button id="reboot-btn" 
                            class="text-sm px-2 py-0.5 rounded border border-transparent 
                                   hover:border-[#ff6347] transition duration-150 text-[var(--error-color)]">
                        // REBOOT
                    </button>
                    <button id="settings-toggle-btn" 
                            class="text-sm px-2 py-0.5 rounded border border-transparent 
                                   hover:border-[#93d6e5] transition duration-150">
                        // SETTINGS
                    </button>
                    <button id="close-terminal-btn" 
                            class="text-sm px-2 py-0.5 rounded border border-transparent 
                                   hover:border-[#ff6347] transition duration-150 text-[var(--error-color)]">
                        // CLOSE
                    </button>
                </div>
            </div>

            <!-- Terminal Output Area -->
            <div id="terminal-output" class="flex-grow terminal-output p-2 overflow-y-auto">
                <!-- Terminal messages will be injected here -->
            </div>

            <!-- Terminal Input Area -->
            <div id="terminal-input" class="terminal-input border-t-2 border-dashed border-[var(--main-color)] p-2 flex-shrink-0">
                <div class="terminal-input-line">
                    <span class="prompt-char select-none font-bold">&gt;</span>
                    <input type="text" id="command-input" class="bg-transparent w-full focus:outline-none text-[var(--main-color)]" autofocus>
                </div>
            </div>
        </div>
        
        <!-- Settings Sidebar (Hidden by Default) -->
        <div id="settings-sidebar" class="settings-sidebar fixed right-0 top-0 h-full w-64 p-4 transform translate-x-full transition-transform duration-300 z-50">
            <div class="flex justify-between items-center mb-6">
                <h4 class="text-lg font-bold">CONFIG</h4>
                <button id="close-settings-btn" class="text-[#ff6347] hover:text-white">&times;</button>
            </div>

            <h5 class="font-semibold mb-2 text-[#93d6e5]">Theme Color:</h5>
            <div id="color-options" class="flex space-x-3">
                <!-- Color options will be generated here -->
            </div>
            
            <button id="save-settings-btn" 
                    class="mt-6 w-full bg-[#ffb861] text-black font-bold py-2 rounded-md hover:bg-[#ff8c4a] transition">
                SAVE & APPLY
            </button>

            <p class="mt-8 text-xs opacity-70">
                Current Settings are stored locally.
            </p>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script type="module">
        // --- All Firebase code has been removed ---

        // --- Target Email Address ---
        const ADMIN_EMAIL = 'devchrisstudios@gmail.com'; 
        
        // --- Maximum length for the ticket details (to prevent URL overflow errors on deployment) ---
        const MAX_TICKET_LENGTH = 1000;

        // --- DOM Elements ---
        const terminalWrapper = document.getElementById('terminal-wrapper');
        const terminalOutput = document.getElementById('terminal-output');
        const commandInput = document.getElementById('command-input');
        const launchBtn = document.getElementById('launch-btn');
        const settingsToggleBtn = document.getElementById('settings-toggle-btn');
        const settingsSidebar = document.getElementById('settings-sidebar');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const colorOptionsContainer = document.getElementById('color-options');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const landingPage = document.getElementById('landing-page');
        const terminalContainer = document.getElementById('terminal-container');
        
        // Terminal control buttons
        const rebootBtn = document.getElementById('reboot-btn');
        const closeTerminalBtn = document.getElementById('close-terminal-btn');

        // Modal elements
        const askFloatBtn = document.getElementById('ask-float-btn');
        const askModalWrapper = document.getElementById('ask-modal-wrapper');
        const askModalClose = document.getElementById('ask-modal-close');
        const askModalEmail = document.getElementById('ask-modal-email'); 
        const askModalInput = document.getElementById('ask-modal-input');
        const askModalSubmit = document.getElementById('ask-modal-submit');
        const modalResponse = document.getElementById('modal-response');
        const modalLoadingIndicator = document.getElementById('modal-loading-indicator');

        // --- State and Config ---
        let commandHistory = [];
        let historyIndex = -1;
        let isProcessing = false;
        let selectedColor = 'amber'; // Default to the new amber theme
        
        // Define color themes
        const colorOptions = {
            amber: {
                main: '#ffb861',
                info: '#f7a049',
                success: '#00ff41',
                error: '#ff6347',
                prompt: '#93d6e5',
                name: 'Amber Glow'
            },
            green: {
                main: '#00ff41',
                info: '#87ceeb',
                success: '#32cd32',
                error: '#ff6347',
                prompt: '#ffc107',
                name: 'Classic Green'
            },
            cyan: {
                main: '#47e5ff',
                info: '#20b2aa',
                success: '#00ff41',
                error: '#ff6347',
                prompt: '#ffb861',
                name: 'Electric Cyan'
            }
        };

        // --- Utility Functions ---

        /**
         * Simple email validation helper.
         * @param {string} email 
         * @returns {boolean}
         */
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        /**
         * Converts plain text into HTML for terminal output, handling newlines.
         * @param {string} text The plain text message.
         * @returns {string} HTML content.
         */
        function formatOutput(text) {
            return text.replace(/\n/g, '<br>');
        }

        /**
         * Prints a message to the terminal output.
         * @param {string} message The text content.
         * @param {string} type 'info', 'success', 'error', 'system' (default).
         */
        function printTerminalMessage(message, type = 'system') {
            const messageElement = document.createElement('div');
            let className = '';

            switch (type) {
                case 'info': className = 'info-message'; break;
                case 'success': className = 'success-message'; break;
                case 'error': className = 'error-message'; break;
                default: className = 'text-[var(--main-color)]'; break;
            }

            messageElement.className = className;
            messageElement.innerHTML = formatOutput(message);
            terminalOutput.appendChild(messageElement);
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }
        
        /**
         * Renders the user's command line to the output.
         * @param {string} command The command entered by the user.
         */
        function printCommand(command) {
            const commandElement = document.createElement('div');
            commandElement.className = 'terminal-input-line';
            commandElement.innerHTML = `<span class="prompt-char select-none font-bold">&gt;</span><span>${formatOutput(command)}</span>`;
            terminalOutput.appendChild(commandElement);
        }

        /**
         * Runs the asynchronous boot sequence when the terminal launches.
         */
        async function runBootSequence() {
            const bootMessages = [
                '// INITIALIZING CORE SYSTEM...',
                '// AUTHENTICATING LOCAL USER...',
                '// LOCAL SESSION ESTABLISHED.',
                '// WELCOME. TYPE "help" FOR AVAILABLE COMMANDS.'
            ];

            // Clear output and print initial system message
            terminalOutput.innerHTML = '';
            printTerminalMessage('[[ SYSTEM BOOT SEQUENCE INITIATED ]]', 'info');
            
            for (const msg of bootMessages) {
                await new Promise(resolve => setTimeout(resolve, 250 + Math.random() * 300));
                printTerminalMessage(msg);
            }

            // After boot sequence, clear any existing input and focus
            commandInput.value = '';
            commandInput.focus();
        }


        // --- Command Handling ---

        /**
         * Processes the command entered by the user.
         * @param {string} command The raw command string.
         */
        function processCommand(command) {
            if (isProcessing) {
                printTerminalMessage('// ERROR: Command processing already in progress.', 'error');
                return;
            }

            // Add to history only if not empty and not a repeat
            if (command && command !== commandHistory[0]) {
                commandHistory.unshift(command);
            }
            historyIndex = -1; // Reset history index

            printCommand(command);
            commandInput.value = '';
            
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0] ? parts[0].toLowerCase() : '';
            const args = command.trim().substring(cmd.length).trim(); // Keep full argument string

            if (!command.trim()) {
                // Do nothing for empty command
            } else if (cmd === 'help') {
                showHelp();
            } else if (cmd === 'clear') {
                terminalOutput.innerHTML = '';
            } else if (cmd === 'settings') {
                toggleSettingsSidebar();
                printTerminalMessage('// CONFIGURATION PANEL DISPLAYED.', 'info');
            } else if (cmd === 'exit') {
                hideTerminal();
            } else if (cmd === 'ticket') { 
                handleTicketCommand(args);
            } else {
                printTerminalMessage(`// ERROR: Command not found: "${cmd}". Type "help" for a list of available commands.`, 'error');
            }
            
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        /**
         * Displays the help message in the terminal.
         */
        function showHelp() {
            const helpText = `
// AVAILABLE COMMANDS:
//   help     - Display this command list.
//   clear    - Clear the terminal screen.
//   settings - Toggle the configuration panel for visual tuning.
//   ticket   - Submit a support or operational ticket. Usage: ticket [email] [details] (Max ${MAX_TICKET_LENGTH} chars)
//   exit     - Close the terminal interface.
`;
            printTerminalMessage(helpText, 'info');
        }

        /**
         * Constructs and opens a STANDARD mailto link to simulate sending the ticket.
         * @param {string} email User's response email.
         * @param {string} details The ticket message body.
         * @param {string} source 'Terminal' or 'Modal'
         * @returns {string} The success message to display.
         */
        function sendTicketViaMailto(email, details, source) {
            const subject = encodeURIComponent(`[Project Phoenix Ticket] Submission from ${source} - ${email}`);
            const body = encodeURIComponent(
                `Source: ${source} Interface\n` +
                `Response Email: ${email}\n` +
                `----------------------------------\n` +
                `TICKET DETAILS:\n${details}`
            );

            // Use the standard mailto protocol
            const mailtoLink = `mailto:${ADMIN_EMAIL}?subject=${subject}&body=${body}`;
            
            // Open the mail client in a new tab/window
            window.open(mailtoLink, '_blank');
            
            return `// TICKET_PROTOCOL_ENGAGED: Your default mail client has been launched in a new tab/window.
// RECIPIENT: ${ADMIN_EMAIL}
// STATUS: Awaiting 'Send' action in your mail client.`;
        }

        /**
         * Handles the 'ticket' command for inline ticket submission.
         * @param {string} fullArgs The full argument string containing [email] and [details].
         */
        async function handleTicketCommand(fullArgs) { 
            // Regex to capture the first non-space argument (email) and the rest (details)
            const argsMatch = fullArgs.match(/^(\S+)\s+(.*)$/s); 

            if (!argsMatch) {
                printTerminalMessage('// ERROR: Ticket command requires an email and details. Usage: ticket [email] [details]', 'error');
                return;
            }
            
            const email = argsMatch[1];
            let ticketDetails = argsMatch[2].trim();

            if (!isValidEmail(email)) {
                printTerminalMessage('// ERROR: Invalid email format for response address.', 'error');
                return;
            }
            if (!ticketDetails) {
                printTerminalMessage('// ERROR: Ticket details cannot be empty.', 'error');
                return;
            }

            // --- URL Length Check for stability on deployment ---
            if (ticketDetails.length > MAX_TICKET_LENGTH) {
                printTerminalMessage(`// ERROR: Ticket details exceed maximum length of ${MAX_TICKET_LENGTH} characters. Please shorten the description.`, 'error');
                return;
            }
            // --- End Length Check ---


            isProcessing = true;
            printTerminalMessage('// TICKET_PROTOCOL_ENGAGED: PREPARING_TRANSMISSION...', 'info');

            // 1. Send via mailto link (now opens standard mail client)
            const successMessage = sendTicketViaMailto(email, ticketDetails, 'Terminal');
            
            // 2. Display success message
            printTerminalMessage(successMessage, 'success');

            isProcessing = false;
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
            commandInput.focus();
        }

        // --- UI/Event Handlers ---

        /**
         * Handles key presses in the input field (Enter, Up, Down).
         */
        function handleInputKeydown(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                processCommand(commandInput.value);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (commandHistory.length > 0) {
                    historyIndex = Math.min(historyIndex + 1, commandHistory.length - 1);
                    commandInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                historyIndex = Math.max(historyIndex - 1, -1);
                commandInput.value = historyIndex === -1 ? '' : commandHistory[historyIndex];
            }
        }

        /**
         * Shows the terminal interface.
         */
        function showTerminal() {
            landingPage.classList.add('hidden');
            askFloatBtn.classList.add('hidden'); // Hide float button when terminal is open
            
            // Hide the main page content (sections) while terminal is open
            document.querySelector('main').classList.add('hidden');

            // Show the terminal overlay
            terminalWrapper.classList.remove('hidden');
            terminalWrapper.classList.add('flex');
            
            // Run the terminal boot sequence
            runBootSequence();
        }

        /**
         * Hides the terminal interface.
         */
        function hideTerminal() {
            landingPage.classList.remove('hidden');
            askFloatBtn.classList.remove('hidden'); // Show float button when terminal is closed
            
            // Show the main page content (sections) when terminal is closed
            document.querySelector('main').classList.remove('hidden');

            terminalWrapper.classList.add('hidden');
            terminalWrapper.classList.remove('flex');
            toggleSettingsSidebar('hide');
        }

        /**
         * Toggles the settings sidebar visibility.
         * @param {'show'|'hide'} [action] Force show or hide.
         */
        function toggleSettingsSidebar(action) {
            const isVisible = settingsSidebar.classList.contains('translate-x-0');

            if (action === 'show' || (!isVisible && action !== 'hide')) {
                settingsSidebar.classList.remove('translate-x-full');
                settingsSidebar.classList.add('translate-x-0');
            } else {
                settingsSidebar.classList.remove('translate-x-0');
                settingsSidebar.classList.add('translate-x-full');
            }
        }

        // --- Color and Settings Logic ---

        /**
         * Renders the color selection circles in the sidebar.
         */
        function renderColorOptions() {
            colorOptionsContainer.innerHTML = '';
            
            // Set the initially selected color based on current state or default 'amber'
            const currentColor = localStorage.getItem('terminalColor') || 'amber';
            selectedColor = currentColor;

            Object.keys(colorOptions).forEach(colorKey => {
                const color = colorOptions[colorKey];
                const div = document.createElement('div');
                div.className = 'color-option';
                div.title = color.name;
                div.dataset.color = colorKey;
                div.style.backgroundColor = color.main;
                div.style.borderColor = color.main;

                if (colorKey === currentColor) {
                    div.classList.add('selected');
                }

                div.addEventListener('click', () => {
                    // Remove selected from all
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected to clicked element
                    div.classList.add('selected');
                    selectedColor = colorKey;
                });
                
                colorOptionsContainer.appendChild(div);
            });
        }

        /**
         * Applies the selected color scheme to the terminal interface.
         * @param {string} colorKey 
         * @param {'boot'|'user'} [mode='user'] Controls whether a message is printed.
         */
        function applyTerminalColors(colorKey, mode = 'user') {
            const colorMap = colorOptions[colorKey];
            if (!colorMap) return;

            const root = document.documentElement;
            
            // Apply variables to CSS root
            root.style.setProperty('--main-color', colorMap.main);
            root.style.setProperty('--info-color', colorMap.info);
            root.style.setProperty('--success-color', colorMap.success);
            root.style.setProperty('--error-color', colorMap.error);
            root.style.setProperty('--prompt-color', colorMap.prompt);

            // Update main container's box shadow and glow (Amber theme specific)
            terminalContainer.style.borderColor = colorMap.main;
            terminalContainer.style.boxShadow = `0 0 15px ${colorMap.main}`;
            
            // Update the main body/landing page colors to match the terminal theme
            document.body.className = `bg-[#0d0101] text-[${colorMap.main}] min-h-screen flex flex-col items-center p-4 font-mono`;
            
            // Convert main color hex to RGB for the drop shadow calculation
            const r = parseInt(colorMap.main.substring(1, 3), 16);
            const g = parseInt(colorMap.main.substring(3, 5), 16);
            const b = parseInt(colorMap.main.substring(5, 7), 16);

            document.getElementById('landing-page').querySelector('h1').className = `text-5xl md:text-7xl font-bold mb-8 drop-shadow-[0_0_15px_rgba(${r},${g},${b},0.7)] tracking-wider`;
            
            // Update the launch button color based on the new theme
            const launchBtnElement = document.getElementById('launch-btn');
            if (launchBtnElement) {
                // Get a slightly darker/complementary hover color for the button
                let hoverColor = '#ff8c4a'; // Default for amber
                if (colorKey === 'green') hoverColor = '#1e7e34';
                if (colorKey === 'cyan') hoverColor = '#1a8a9a';

                // Use attribute modification for Tailwind to pick up dynamic colors correctly
                launchBtnElement.setAttribute('style', 
                    `background-color: ${colorMap.main}; 
                     box-shadow: 0 0 10px ${colorMap.main};
                     --tw-ring-color: ${colorMap.main};`);
                launchBtnElement.onmouseover = () => {
                    launchBtnElement.style.backgroundColor = hoverColor;
                };
                launchBtnElement.onmouseout = () => {
                    launchBtnElement.style.backgroundColor = colorMap.main;
                };

                // The default classes handle the rest of the styling
                launchBtnElement.className = `bg-[${colorMap.main}] text-black font-bold py-3 px-8 rounded-lg uppercase shadow-[0_0_10px_${colorMap.main}] hover:bg-[${hoverColor}] transition duration-300 transform hover:scale-105`;

            }

            // Update navigation links to match the new theme colors
            document.querySelectorAll('.nav-link').forEach(link => {
                link.style.color = colorMap.main;
                link.style.textShadow = `0 0 5px ${colorMap.main + '80'}`;
            });


            // Apply CRT glow shadow to the terminal text
            let terminalThemeStyle = document.head.querySelector('[data-glow-style]');
            if (!terminalThemeStyle) {
                terminalThemeStyle = document.createElement('style');
                terminalThemeStyle.setAttribute('data-glow-style', 'true');
                document.head.appendChild(terminalThemeStyle);
            }
            terminalThemeStyle.innerHTML = `
                .terminal-theme {
                    text-shadow: 0 0 7px ${colorMap.main + 'c0'}; /* Slightly transparent glow */
                }
            `;


            if (mode === 'user') {
                printTerminalMessage(`// SYSTEM_STATUS: Theme applied successfully: ${colorMap.name}`, 'success');
            }
        }

        /**
         * Saves the selected color scheme to local storage and applies it.
         */
        function saveSettings() {
            localStorage.setItem('terminalColor', selectedColor);
            applyTerminalColors(selectedColor);
            toggleSettingsSidebar('hide');
        }

        /**
         * Loads saved terminal color from local storage on initial page load.
         */
        function loadSavedSettings() {
            // Default to 'amber' if nothing is saved
            const savedColor = localStorage.getItem('terminalColor') || 'amber'; 
            if (savedColor) {
                // Use 'boot' to suppress the terminal message during startup
                applyTerminalColors(savedColor, 'boot'); 
                selectedColor = savedColor;
            }
            renderColorOptions(); // Render options after loading the saved color
        }


        // --- Modal Ticket Submission Functions ---

        function showAskModal() {
            askModalWrapper.classList.remove('hidden');
            askModalWrapper.classList.add('flex');
            askModalInput.focus();
            askModalEmail.value = ''; // Clear email input
            askModalInput.value = ''; // Clear details input
            modalResponse.innerHTML = '';
        }

        function closeAskModal() {
            askModalWrapper.classList.add('hidden');
            askModalWrapper.classList.remove('flex');
            modalLoadingIndicator.classList.add('hidden');
        }

        async function handleModalAsk() { 
            const email = askModalEmail.value.trim();
            const query = askModalInput.value.trim();
            
            // VALIDATION
            if (!email || !isValidEmail(email)) {
                modalResponse.innerHTML = `<span class="text-[#ff6347]">// ERROR: Invalid or missing email address for response.</span>`;
                askModalEmail.focus();
                return;
            }
            if (!query) {
                modalResponse.innerHTML = `<span class="text-[#ff6347]">// ERROR: Ticket details cannot be empty.</span>`;
                askModalInput.focus();
                return;
            }

            // --- URL Length Check for stability on deployment (Kept as a safeguard) ---
            if (query.length > MAX_TICKET_LENGTH) {
                modalResponse.innerHTML = `<span class="text-[#ff6347]">// ERROR: Ticket details exceed maximum length of ${MAX_TICKET_LENGTH} characters. Please shorten the description.</span>`;
                askModalInput.focus();
                return;
            }
            // --- End Length Check ---


            askModalInput.disabled = true;
            askModalEmail.disabled = true;
            askModalSubmit.disabled = true;
            modalResponse.innerHTML = '';
            modalLoadingIndicator.classList.remove('hidden');

            try {
                // Use the standard mailto function
                const successMessage = sendTicketViaMailto(email, query, 'Modal');

                modalResponse.innerHTML = formatOutput(successMessage);
                
                // TWEAK: Clear and Close on Success after a short delay
                setTimeout(() => {
                    askModalEmail.value = ''; // Clear email
                    askModalInput.value = ''; // Clear details
                    closeAskModal(); // Close the modal
                }, 4000); // Give the user 4 seconds to read the success message

            } catch (error) {
                // Log the actual error to the console for detailed debugging
                console.error('Modal Ticket Error (Deployment Check):', error);
                modalResponse.innerHTML = `<span class="text-[#ff6347]">[[ ERROR: System failure during email link generation. Check console for details. ]]</span>`;
            } finally {
                modalLoadingIndicator.classList.add('hidden');
                askModalInput.disabled = false;
                askModalEmail.disabled = false;
                askModalSubmit.disabled = false;
                // Note: The modal closure is handled by the setTimeout inside the try block
            }
        }


        // --- Initialization ---
        
        // Attach event listeners
        launchBtn.addEventListener('click', showTerminal);
        settingsToggleBtn.addEventListener('click', toggleSettingsSidebar);
        closeSettingsBtn.addEventListener('click', () => toggleSettingsSidebar('hide'));
        saveSettingsBtn.addEventListener('click', saveSettings);
        commandInput.addEventListener('keydown', handleInputKeydown);
        
        // New Terminal Control Buttons
        rebootBtn.addEventListener('click', runBootSequence);
        closeTerminalBtn.addEventListener('click', hideTerminal);
        
        // Ticket button and modal listeners
        askFloatBtn.addEventListener('click', showAskModal);
        askModalClose.addEventListener('click', closeAskModal);
        askModalSubmit.addEventListener('click', handleModalAsk);
        askModalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { // Allow Shift+Enter for new line
                e.preventDefault();
                handleModalAsk();
            }
        });
        
        loadSavedSettings();
        // No initFirebase() call needed anymore

    </script>

</body>
</html>